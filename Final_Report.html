<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Esha Teware &amp; William Shields">
<meta name="dcterms.date" content="2025-12-03">

<title>Empirical Analysis of Bank Marketing Success through Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Final_Report_files/libs/clipboard/clipboard.min.js"></script>
<script src="Final_Report_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Final_Report_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Final_Report_files/libs/quarto-html/popper.min.js"></script>
<script src="Final_Report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Final_Report_files/libs/quarto-html/anchor.min.js"></script>
<link href="Final_Report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Final_Report_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Final_Report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Final_Report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Final_Report_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Empirical Analysis of Bank Marketing Success through Machine Learning</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Esha Teware &amp; William Shields </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 3, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This report seeks to replicate the work from the 2014 paper by Moro et al, <em>A data-driven approach to predict the success of bank telemarketing.</em> Following the paper, we implement logistic regression, decision trees, a support vector machine, and a neural network. Additionally we explore the effectiveness of linear discriminant analysis and K-nearest neighbors on the problem.</p>
</section>
<section id="data-loading-and-splitting-for-train-test" class="level2">
<h2 class="anchored" data-anchor-id="data-loading-and-splitting-for-train-test">Data Loading and Splitting for Train Test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>bank <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"../data/bank-additional-full.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, as.factor) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(bank)), <span class="at">size =</span> <span class="fu">floor</span>(<span class="fl">0.8</span> <span class="sc">*</span> <span class="fu">nrow</span>(bank)))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>bankTrain <span class="ot">&lt;-</span> bank[split, ]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>bankTest  <span class="ot">&lt;-</span> bank[<span class="sc">-</span>split, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="eda-and-data-overview" class="level2">
<h2 class="anchored" data-anchor-id="eda-and-data-overview">EDA and Data overview</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
    age job    marital education default housing loan  contact month day_of_week
  &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;      
1    56 house… married basic.4y  no      no      no    teleph… may   mon        
2    57 servi… married high.sch… unknown no      no    teleph… may   mon        
3    37 servi… married high.sch… no      yes     no    teleph… may   mon        
4    40 admin. married basic.6y  no      no      no    teleph… may   mon        
5    56 servi… married high.sch… no      no      yes   teleph… may   mon        
6    45 servi… married basic.9y  unknown no      no    teleph… may   mon        
# ℹ 11 more variables: duration &lt;dbl&gt;, campaign &lt;dbl&gt;, pdays &lt;dbl&gt;,
#   previous &lt;dbl&gt;, poutcome &lt;fct&gt;, emp_var_rate &lt;dbl&gt;, cons_price_idx &lt;dbl&gt;,
#   cons_conf_idx &lt;dbl&gt;, euribor3m &lt;dbl&gt;, nr_employed &lt;dbl&gt;, y &lt;fct&gt;</code></pre>
</div>
</div>
<p>Our dataset consists of 41188 observations of 21 variables. Ten of these variables are numeric, and the remaining 11 are categorical(this 11 includes the response). The response variable, <span class="math inline">\(y\)</span> is whether or not the client of the bank will subscribe a term deposit. This data comes from a Portuguese banking institution.</p>
<section id="variable-overview" class="level3">
<h3 class="anchored" data-anchor-id="variable-overview">Variable Overview</h3>
<p><span class="math inline">\(age\)</span>: Age of contacted person</p>
<p><span class="math inline">\(job\)</span>: Job of contacted person</p>
<p><span class="math inline">\(marital\)</span>: Marital status of contacted person</p>
<p><span class="math inline">\(education\)</span>: Highest education of contacted person</p>
<p><span class="math inline">\(default\)</span>: If contacted has credit in default</p>
<p><span class="math inline">\(housing\)</span>: If contacted has a housing loan</p>
<p><span class="math inline">\(loan\)</span>: If contacted has personal loan</p>
<p><span class="math inline">\(contact\)</span>: Method of contact(telephone = landline)</p>
<p><span class="math inline">\(month\)</span>: Month of contact</p>
<p><span class="math inline">\(day\_of\_week\)</span>: Day of week contacted</p>
<p><span class="math inline">\(duration\)</span>: Length of contact in seconds (Note: highly effects value of <span class="math inline">\(y\)</span>, should not be included in a model for realistic predictions)</p>
<p><span class="math inline">\(campaign\)</span>: number of contacts performed during the campaign for this client(includes last contact)</p>
<p><span class="math inline">\(pdays\)</span>: days passed since last contacted</p>
<p><span class="math inline">\(previous\)</span>: number of contacts performed before this campaign</p>
<p><span class="math inline">\(poutcome\)</span>: outcome of previous marketing campaign</p>
<p><span class="math inline">\(emp\_var\_rate\)</span>: employment variation rate, updated quarterly</p>
<p><span class="math inline">\(cons\_price\_index\)</span>: monthly average of consumer price index</p>
<p><span class="math inline">\(cons\_conf\_index\)</span>: monthly average of consumer confidence index</p>
<p><span class="math inline">\(euribor3m\)</span>: daily 3 month euro rate</p>
<p><span class="math inline">\(nr\_employed\)</span>: quarterly average of the total number of employed citizens</p>
<p><span class="math inline">\(y\)</span>: has the client subscribed a term deposit?</p>
</section>
</section>
<section id="missing-values-check" class="level2">
<h2 class="anchored" data-anchor-id="missing-values-check">Missing values check</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"missing_count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(missing_count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 2
   variable    missing_count
   &lt;chr&gt;               &lt;int&gt;
 1 age                     0
 2 job                     0
 3 marital                 0
 4 education               0
 5 default                 0
 6 housing                 0
 7 loan                    0
 8 contact                 0
 9 month                   0
10 day_of_week             0
# ℹ 11 more rows</code></pre>
</div>
</div>
<p>No missing values are present in the dataset.</p>
</section>
<section id="overview-of-the-response" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-the-response">Overview of the response</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bank <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(y) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Percent =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> Percent, <span class="at">fill =</span> y)) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(Percent, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Term Deposit Subscription Rate"</span>, <span class="at">x =</span> <span class="st">"Subscribed (y)"</span>, <span class="at">y =</span> <span class="st">"Proportion"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A significant majority of the observations in the data have the value of <span class="math inline">\(no\)</span> for the response variable.</p>
</section>
<section id="overview-of-numeric-variables" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-numeric-variables">Overview of Numeric Variables</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>numeric_vars <span class="ot">&lt;-</span> bank <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(numeric_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">numeric_vars</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">41188</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">40.02</td>
<td style="text-align: right;">10.42</td>
<td style="text-align: right;">17.00</td>
<td style="text-align: right;">32.00</td>
<td style="text-align: right;">38.00</td>
<td style="text-align: right;">47.00</td>
<td style="text-align: right;">98.00</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">duration</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">258.29</td>
<td style="text-align: right;">259.28</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">102.00</td>
<td style="text-align: right;">180.00</td>
<td style="text-align: right;">319.00</td>
<td style="text-align: right;">4918.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">campaign</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">2.77</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">56.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">pdays</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">962.48</td>
<td style="text-align: right;">186.91</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">999.00</td>
<td style="text-align: right;">999.00</td>
<td style="text-align: right;">999.00</td>
<td style="text-align: right;">999.00</td>
<td style="text-align: left;">▁▁▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">previous</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">emp_var_rate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">1.57</td>
<td style="text-align: right;">-3.40</td>
<td style="text-align: right;">-1.80</td>
<td style="text-align: right;">1.10</td>
<td style="text-align: right;">1.40</td>
<td style="text-align: right;">1.40</td>
<td style="text-align: left;">▁▃▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cons_price_idx</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">93.58</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">92.20</td>
<td style="text-align: right;">93.08</td>
<td style="text-align: right;">93.75</td>
<td style="text-align: right;">93.99</td>
<td style="text-align: right;">94.77</td>
<td style="text-align: left;">▁▆▃▇▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">cons_conf_idx</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-40.50</td>
<td style="text-align: right;">4.63</td>
<td style="text-align: right;">-50.80</td>
<td style="text-align: right;">-42.70</td>
<td style="text-align: right;">-41.80</td>
<td style="text-align: right;">-36.40</td>
<td style="text-align: right;">-26.90</td>
<td style="text-align: left;">▅▇▁▇▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">euribor3m</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.62</td>
<td style="text-align: right;">1.73</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">1.34</td>
<td style="text-align: right;">4.86</td>
<td style="text-align: right;">4.96</td>
<td style="text-align: right;">5.04</td>
<td style="text-align: left;">▅▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">nr_employed</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5167.04</td>
<td style="text-align: right;">72.25</td>
<td style="text-align: right;">4963.60</td>
<td style="text-align: right;">5099.10</td>
<td style="text-align: right;">5191.00</td>
<td style="text-align: right;">5228.10</td>
<td style="text-align: right;">5228.10</td>
<td style="text-align: left;">▁▁▃▁▇</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="histograms-of-numeric-variables" class="level3">
<h3 class="anchored" data-anchor-id="histograms-of-numeric-variables">Histograms of Numeric Variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>numeric_vars <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"#69b3a2"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distributions of Numeric Variables"</span>, <span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-of-numeric-variables" class="level3">
<h3 class="anchored" data-anchor-id="correlation-of-numeric-variables">Correlation of Numeric Variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(numeric_vars)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(cor_matrix, <span class="at">type =</span> <span class="st">"lower"</span>, <span class="at">lab =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="st">"Correlation Heatmap of Numeric Variables"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The pairs of, <span class="math inline">\(euribor3m\)</span> and <span class="math inline">\(nr\_employed\)</span>, <span class="math inline">\(euribor3m\)</span> and <span class="math inline">\(emp\_var\_rate\)</span>, <span class="math inline">\(nr\_employed\)</span> and <span class="math inline">\(emp\_var\_rate\)</span> are highly correlated. The values for these variables are the same across large groups of observations as they are economic indicators that change on either a quarterly( for <span class="math inline">\(nr\_employed\)</span> and <span class="math inline">\(emp\_var\_rate\)</span>) or daily(for <span class="math inline">\(euribor3m\)</span>) frequency.</p>
</section>
<section id="numeric-variables-vs-response" class="level3">
<h3 class="anchored" data-anchor-id="numeric-variables-vs-response">Numeric Variables vs Response</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>numeric_vars <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rep</span>(bank<span class="sc">$</span>y, <span class="at">times =</span> <span class="fu">length</span>(numeric_vars))) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> value, <span class="at">fill =</span> y)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">outlier.color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Numeric Variables by Subscription Status"</span>, <span class="at">x =</span> <span class="st">"Subscribed (y)"</span>, <span class="at">y =</span> <span class="st">"Value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="overview-of-categorical-variables" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-categorical-variables">Overview of Categorical Variables</h2>
<section id="frequency-plots-of-categorical-variables" class="level3">
<h3 class="anchored" data-anchor-id="frequency-plots-of-categorical-variables">Frequency Plots of Categorical Variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cat_vars <span class="ot">&lt;-</span> bank <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">where</span>(is.factor)) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>y)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>cat_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(var) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(bank, <span class="fu">aes</span>(<span class="at">x =</span> .data[[var]], <span class="at">fill =</span> .data[[var]])) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Distribution of"</span>, var), <span class="at">x =</span> var, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(cat_vars <span class="sc">%&gt;%</span> <span class="fu">names</span>(), cat_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[9]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[10]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-11-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Most categorical variable distributions appear to dominated by one or two levels. Note: Some levels appear to have zero recorded observations. In actuality they have so few they do not appear in this scale. For example, there are only three recorded observations of yes for <span class="math inline">\(default\)</span> in the entire dataset.</p>
</section>
<section id="categorical-variables-vs-response" class="level3">
<h3 class="anchored" data-anchor-id="categorical-variables-vs-response">Categorical Variables vs Response</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cat_vs_target <span class="ot">&lt;-</span> <span class="cf">function</span>(var) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(bank, <span class="fu">aes</span>(<span class="at">x =</span> .data[[var]], <span class="at">fill =</span> y)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Subscription Rate by"</span>, var),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> var, <span class="at">y =</span> <span class="st">"Proportion of Subscriptions"</span>) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(cat_vars <span class="sc">%&gt;%</span> <span class="fu">names</span>(), cat_vs_target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[9]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[10]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-12-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As expected from looking at the frequency of the response earlier, most levels of our categorical variables primarily result in <span class="math inline">\(no\)</span> for the response. Notable differences are the increased amount of <span class="math inline">\(yes\)</span> in the months of December, March, October, and September. As well as the large number of <span class="math inline">\(yes\)</span> when <span class="math inline">\(poutcome\)</span> is <span class="math inline">\(success\)</span>. <span class="math inline">\(poutcome\)</span> is the result of the previous marketing campaign with a customer, so it is not surprising that a customer who has subscribed for a term deposit before would be more likely to do so again.</p>
</section>
</section>
<section id="logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-model">Logistic Regression Model</h2>
<section id="baseline-model" class="level3">
<h3 class="anchored" data-anchor-id="baseline-model">Baseline Model</h3>
<p>This model only uses variables similar to the ones used in the paper.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>bank_lr_paper <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> housing <span class="sc">+</span> loan <span class="sc">+</span> default <span class="sc">+</span> month <span class="sc">+</span> emp_var_rate <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                       cons_price_idx <span class="sc">+</span> cons_conf_idx <span class="sc">+</span> euribor3m <span class="sc">+</span> nr_employed,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> bankTrain, <span class="at">family =</span> binomial)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bank_lr_paper)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ housing + loan + default + month + emp_var_rate + 
    cons_price_idx + cons_conf_idx + euribor3m + nr_employed, 
    family = binomial, data = bankTrain)

Coefficients: (1 not defined because of singularities)
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -73.227595  33.400036  -2.192   0.0283 *  
housingunknown  -0.107226   0.131304  -0.817   0.4141    
housingyes      -0.010549   0.039267  -0.269   0.7882    
loanunknown            NA         NA      NA       NA    
loanyes         -0.022670   0.054356  -0.417   0.6766    
defaultunknown  -0.297043   0.061835  -4.804 1.56e-06 ***
defaultyes      -8.663003 113.650453  -0.076   0.9392    
monthaug         0.578991   0.115082   5.031 4.88e-07 ***
monthdec         0.460797   0.197281   2.336   0.0195 *  
monthjul         0.436344   0.085796   5.086 3.66e-07 ***
monthjun        -0.243238   0.116024  -2.096   0.0360 *  
monthmar         1.227382   0.137788   8.908  &lt; 2e-16 ***
monthmay        -0.577777   0.075823  -7.620 2.54e-14 ***
monthnov        -0.196801   0.112952  -1.742   0.0814 .  
monthoct         0.010694   0.145954   0.073   0.9416    
monthsep         0.146662   0.167715   0.874   0.3819    
emp_var_rate    -0.858034   0.124754  -6.878 6.08e-12 ***
cons_price_idx   1.006546   0.215866   4.663 3.12e-06 ***
cons_conf_idx    0.010506   0.006901   1.522   0.1279    
euribor3m        0.201700   0.122062   1.652   0.0984 .  
nr_employed     -0.004551   0.002795  -1.628   0.1035    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 23162  on 32949  degrees of freedom
Residual deviance: 18933  on 32930  degrees of freedom
AIC: 18973

Number of Fisher Scoring iterations: 10</code></pre>
</div>
</div>
<section id="cross-validation-of-baseline-model" class="level4">
<h4 class="anchored" data-anchor-id="cross-validation-of-baseline-model">Cross-Validation of Baseline Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>loss <span class="ot">&lt;-</span> <span class="cf">function</span>(Y, pred_p){</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>((Y <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> pred_p <span class="sc">&lt;</span> <span class="fl">0.5</span>) <span class="sc">|</span> (Y <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> pred_p <span class="sc">&gt;=</span> <span class="fl">0.5</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>bank_lr_paper_k_fold <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(bankTrain, bank_lr_paper, <span class="at">cost =</span> loss, <span class="at">K =</span> <span class="dv">10</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>bank_lr_paper_k_fold<span class="sc">$</span>delta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1120486 0.1121032</code></pre>
</div>
</div>
</section>
<section id="test-performance" class="level4">
<h4 class="anchored" data-anchor-id="test-performance">Test Performance</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bankTest<span class="sc">$</span>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(bank_lr_paper, <span class="at">newdata =</span> bankTest, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>bankTest<span class="sc">$</span>pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bankTest<span class="sc">$</span>pred_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bankTest<span class="sc">$</span>pred_class, bankTest<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     
        no  yes
  no  7190  805
  yes  111  132</code></pre>
</div>
</div>
</section>
<section id="roc-and-auc" class="level4">
<h4 class="anchored" data-anchor-id="roc-and-auc">ROC and AUC</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>roc.predictions <span class="ot">&lt;-</span> <span class="fu">prediction</span>(bankTest<span class="sc">$</span>pred_prob, bankTest<span class="sc">$</span>y)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>roc.perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.predictions, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc.perf, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"ROC Curve – Paper Logistic Model"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>paper_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.predictions, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>paper_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7885172</code></pre>
</div>
</div>
</section>
</section>
<section id="extended-model" class="level3">
<h3 class="anchored" data-anchor-id="extended-model">Extended Model</h3>
<p>The purpose of this model is to expand on the baseline using variables present in our dataset that are not mentioned or used by the paper. These predictors are more socio-demographic and campaign related than the primarily economic variables used in the baseline model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>bank_lr_extended <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> job <span class="sc">+</span> marital <span class="sc">+</span> education <span class="sc">+</span> housing <span class="sc">+</span> loan <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                          month <span class="sc">+</span> day_of_week <span class="sc">+</span> campaign <span class="sc">+</span> emp_var_rate <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                          cons_price_idx <span class="sc">+</span> cons_conf_idx <span class="sc">+</span> euribor3m <span class="sc">+</span> nr_employed,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> bankTrain, <span class="at">family =</span> binomial)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bank_lr_extended)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ job + marital + education + housing + loan + 
    month + day_of_week + campaign + emp_var_rate + cons_price_idx + 
    cons_conf_idx + euribor3m + nr_employed, family = binomial, 
    data = bankTrain)

Coefficients: (1 not defined because of singularities)
                               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -86.748021  33.715775  -2.573  0.01008 *  
jobblue-collar                -0.186817   0.075134  -2.486  0.01290 *  
jobentrepreneur               -0.075396   0.118211  -0.638  0.52360    
jobhousemaid                   0.010996   0.134895   0.082  0.93503    
jobmanagement                 -0.066744   0.081294  -0.821  0.41164    
jobretired                     0.201430   0.089866   2.241  0.02500 *  
jobself-employed              -0.160230   0.112896  -1.419  0.15582    
jobservices                   -0.174870   0.082321  -2.124  0.03365 *  
jobstudent                     0.192392   0.106302   1.810  0.07032 .  
jobtechnician                 -0.022693   0.067994  -0.334  0.73857    
jobunemployed                 -0.052024   0.120432  -0.432  0.66576    
jobunknown                     0.003952   0.219974   0.018  0.98567    
maritalmarried                 0.003024   0.064859   0.047  0.96281    
maritalsingle                  0.072074   0.070544   1.022  0.30693    
maritalunknown                 0.557652   0.381526   1.462  0.14384    
educationbasic.6y              0.098966   0.112211   0.882  0.37780    
educationbasic.9y             -0.045512   0.089239  -0.510  0.61005    
educationhigh.school           0.010014   0.085792   0.117  0.90708    
educationilliterate            0.977723   0.730370   1.339  0.18068    
educationprofessional.course   0.071060   0.094983   0.748  0.45438    
educationuniversity.degree     0.125550   0.085446   1.469  0.14174    
educationunknown               0.026236   0.115534   0.227  0.82036    
housingunknown                -0.107408   0.131567  -0.816  0.41428    
housingyes                    -0.013553   0.039400  -0.344  0.73086    
loanunknown                          NA         NA      NA       NA    
loanyes                       -0.021869   0.054588  -0.401  0.68869    
monthaug                       0.548268   0.115822   4.734 2.20e-06 ***
monthdec                       0.501690   0.198805   2.524  0.01162 *  
monthjul                       0.437246   0.086750   5.040 4.65e-07 ***
monthjun                      -0.254402   0.117568  -2.164  0.03047 *  
monthmar                       1.238597   0.138650   8.933  &lt; 2e-16 ***
monthmay                      -0.553120   0.076851  -7.197 6.14e-13 ***
monthnov                      -0.181098   0.113037  -1.602  0.10913    
monthoct                       0.016722   0.146778   0.114  0.90929    
monthsep                       0.174119   0.168671   1.032  0.30193    
day_of_weekmon                -0.178722   0.063503  -2.814  0.00489 ** 
day_of_weekthu                 0.126040   0.060847   2.071  0.03832 *  
day_of_weektue                 0.104310   0.062778   1.662  0.09660 .  
day_of_weekwed                 0.201070   0.062434   3.221  0.00128 ** 
campaign                      -0.053087   0.010252  -5.178 2.24e-07 ***
emp_var_rate                  -0.874078   0.125659  -6.956 3.50e-12 ***
cons_price_idx                 1.076637   0.217767   4.944 7.65e-07 ***
cons_conf_idx                  0.009219   0.006969   1.323  0.18590    
euribor3m                      0.152398   0.123417   1.235  0.21689    
nr_employed                   -0.003179   0.002825  -1.126  0.26036    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 23162  on 32949  degrees of freedom
Residual deviance: 18825  on 32906  degrees of freedom
AIC: 18913

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<section id="test-performance-1" class="level4">
<h4 class="anchored" data-anchor-id="test-performance-1">Test Performance</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>bankTest<span class="sc">$</span>pred_prob_ext <span class="ot">&lt;-</span> <span class="fu">predict</span>(bank_lr_extended, <span class="at">newdata =</span> bankTest, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>bankTest<span class="sc">$</span>pred_class_ext <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bankTest<span class="sc">$</span>pred_prob_ext <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bankTest<span class="sc">$</span>pred_class_ext, bankTest<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     
        no  yes
  no  7164  798
  yes  137  139</code></pre>
</div>
</div>
</section>
<section id="roc-and-auc-1" class="level4">
<h4 class="anchored" data-anchor-id="roc-and-auc-1">ROC and AUC</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>roc.pred.ext <span class="ot">&lt;-</span> <span class="fu">prediction</span>(bankTest<span class="sc">$</span>pred_prob_ext, bankTest<span class="sc">$</span>y)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>roc.perf.ext <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.pred.ext, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc.perf.ext, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"ROC Curve – Extended Logistic"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>extended_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.pred.ext, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>extended_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7894856</code></pre>
</div>
</div>
<p>The extended model does not show a major improvement over the baseline (AUC of <span class="math inline">\(0.7885\)</span> vs <span class="math inline">\(0.7895\)</span>). While some of the added predictors show as being significant the large number of predictors could be reduce to avoid an overly flexible model and any potential concerns of multicollinearity. To address this we will perform Ridge and LASSO regression and see if we gain any improvement.</p>
</section>
</section>
<section id="ridge-and-lasso-regression" class="level3">
<h3 class="anchored" data-anchor-id="ridge-and-lasso-regression">Ridge and LASSO Regression</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data first so model.matrix creates consistent columns</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>x_all <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(y <span class="sc">~</span> .<span class="sc">-</span>duration, bank)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>y_all <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bank<span class="sc">$</span>y <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use same split indices as before</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> x_all[split, ]</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>x_test  <span class="ot">&lt;-</span> x_all[<span class="sc">-</span>split, ]</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> y_all[split]</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>y_test  <span class="ot">&lt;-</span> y_all[<span class="sc">-</span>split]</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>ridge_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x_train, y_train, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>lasso_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x_train, y_train, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>ridge_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge_cv, <span class="at">s =</span> ridge_cv<span class="sc">$</span>lambda.min, <span class="at">newx =</span> x_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>lasso_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_cv, <span class="at">s =</span> lasso_cv<span class="sc">$</span>lambda.min, <span class="at">newx =</span> x_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>ridge_cv<span class="sc">$</span>lambda.min   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01112103</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>lasso_cv<span class="sc">$</span>lambda.min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0001812451</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate AUC</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ridge_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(<span class="fu">prediction</span>(ridge_pred, y_test), <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>lasso_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(<span class="fu">prediction</span>(lasso_pred, y_test), <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">Ridge_AUC =</span> ridge_auc, <span class="at">LASSO_AUC =</span> lasso_auc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ridge_AUC LASSO_AUC 
0.7955330 0.7980946 </code></pre>
</div>
</div>
<p>The RIDGE and LASSO perform only slightly beter in terms of AUC to to the previous extended logistic regression. Our models fail to reach the AUC of <span class="math inline">\(0.9\)</span> seen in the paper. This is likely due to the difference in predictors between our dataset and the one used by the authors.</p>
</section>
</section>
<section id="decision-trees" class="level2">
<h2 class="anchored" data-anchor-id="decision-trees">Decision Trees</h2>
<section id="baseline-tree" class="level3">
<h3 class="anchored" data-anchor-id="baseline-tree">Baseline Tree</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>bank_tree_paper <span class="ot">&lt;-</span> <span class="fu">tree</span>(y <span class="sc">~</span> housing <span class="sc">+</span> loan <span class="sc">+</span> default <span class="sc">+</span> month <span class="sc">+</span> emp_var_rate <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                          cons_price_idx <span class="sc">+</span> cons_conf_idx <span class="sc">+</span> euribor3m <span class="sc">+</span> nr_employed,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> bankTrain)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bank_tree_paper)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
tree(formula = y ~ housing + loan + default + month + emp_var_rate + 
    cons_price_idx + cons_conf_idx + euribor3m + nr_employed, 
    data = bankTrain)
Variables actually used in tree construction:
[1] "nr_employed" "month"      
Number of terminal nodes:  3 
Residual mean deviance:  0.5833 = 19220 / 32950 
Misclassification error rate: 0.1124 = 3703 / 32950 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bank_tree_paper)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(bank_tree_paper, <span class="at">pretty =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Due to the small amount of <span class="math inline">\(Yes\)</span> classifications in the dataset the tree algorithm decides that just classifying everything as <span class="math inline">\(No\)</span> is the best option. We will extend the model to avoid this.</p>
</section>
<section id="extended-tree" class="level3">
<h3 class="anchored" data-anchor-id="extended-tree">Extended Tree</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>bank_tree_extended <span class="ot">&lt;-</span> <span class="fu">tree</span>(y <span class="sc">~</span> .<span class="sc">-</span>duration, <span class="at">data =</span> bankTrain)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bank_tree_extended)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
tree(formula = y ~ . - duration, data = bankTrain)
Variables actually used in tree construction:
[1] "nr_employed" "poutcome"    "month"      
Number of terminal nodes:  4 
Residual mean deviance:  0.5718 = 18840 / 32950 
Misclassification error rate: 0.1003 = 3304 / 32950 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bank_tree_extended)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(bank_tree_extended, <span class="at">pretty =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The extended tree using all predictors, minus <span class="math inline">\(duration\)</span>, does improve over the baseline tree. However, it is still using very few variables. We will attempt to use a random forest to draw on more variables in the dataset.</p>
</section>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest">Random Forest</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>bank_rf <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(y <span class="sc">~</span> .<span class="sc">-</span>duration, <span class="at">data =</span> bankTrain, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>bank_rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = y ~ . - duration, data = bankTrain, importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 4

        OOB estimate of  error rate: 10.19%
Confusion matrix:
       no  yes class.error
no  28546  701  0.02396827
yes  2658 1045  0.71779638</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">importance</span>(bank_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      no        yes MeanDecreaseAccuracy MeanDecreaseGini
age            37.861415  -2.919408            36.326550        678.49131
job            54.638634  -8.558806            49.907112        491.52416
marital        21.445248  -3.483126            19.551646        177.20019
education      36.844978  -5.363057            34.189509        364.62813
default        13.705130   5.274961            16.751491         59.80524
housing         4.444870  -2.696085             2.912556        157.65147
loan            1.119407   1.078871             1.494060        116.28742
contact         9.558616  24.360151            11.557408         75.15989
month          25.892094 -10.403460            26.676717        199.31418
day_of_week    30.574919   2.548788            31.789284        314.88489
campaign       10.575089   8.465807            13.563877        333.74242
pdays           7.842338  32.960934            23.829251        242.62863
previous        7.831715   4.872230             8.783294         98.86626
poutcome       14.046868  12.687088            18.885806        199.12110
emp_var_rate   16.728067   1.919868            17.757091        133.51174
cons_price_idx 18.413780 -13.098852            18.414985        116.39475
cons_conf_idx  18.491793  -5.603056            19.156434        145.60837
euribor3m      26.970699   5.534309            29.044240        676.25921
nr_employed    20.957687  18.922961            24.667643        392.90693</code></pre>
</div>
</div>
<p>From these results we can see an improvement over the previous trees. The Out-Of-Bag error rate is at <span class="math inline">\(10.19\%\)</span>. Though it is important to note the high class error rate for <span class="math inline">\(yes\)</span> of <span class="math inline">\(0.72\)</span>. The Random Forest has greatly expanded the variables used in the classification process, <span class="math inline">\(nr\_employed\)</span> has been determined to be the least important variable in the classification process.</p>
<section id="auc-of-random-forest" class="level4">
<h4 class="anchored" data-anchor-id="auc-of-random-forest">AUC of Random Forest</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>rf_auc_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(bank_rf, <span class="at">newdata =</span> bankTest, <span class="at">type =</span> <span class="st">"prob"</span>)[,<span class="dv">2</span>]</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>roc.predictions <span class="ot">&lt;-</span> <span class="fu">prediction</span>(rf_auc_preds, bankTest<span class="sc">$</span>y)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>roc.perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.predictions, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc.perf, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"ROC Curve – Random Forest"</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>rf_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.predictions, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>rf_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8023081</code></pre>
</div>
</div>
<p>The AUC of the tree model results in <span class="math inline">\(0.802\)</span>. This is not far off from the AUC of <span class="math inline">\(0.833\)</span> obtained by Moro et al.</p>
</section>
<section id="test-prediction-of-random-forest" class="level4">
<h4 class="anchored" data-anchor-id="test-prediction-of-random-forest">Test Prediction of Random Forest</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>rf_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(bank_rf, <span class="at">newdata =</span> bankTest, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(rf_preds <span class="sc">!=</span> bankTest<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1028162</code></pre>
</div>
</div>
<p>The Out-Of-Bag estimation of error was very close to the test error rate. As the test misclassification rate was <span class="math inline">\(10.28\%\)</span></p>
</section>
</section>
<section id="comparison-of-extended-tree-and-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="comparison-of-extended-tree-and-random-forest">Comparison of Extended Tree and Random Forest</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(rf_preds, bankTest<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        
rf_preds   no  yes
     no  7110  656
     yes  191  281</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>extended_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(bank_tree_extended, <span class="at">newdata =</span> bankTest, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(extended_preds, bankTest<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              
extended_preds   no  yes
           no  7231  775
           yes   70  162</code></pre>
</div>
</div>
<p>Overall the extended model tree and the random forest perform somewhat similarly, but the extended model appears to perform better than the random forest. Lets compute the AUC of the extended model tree for comparison’s sake.</p>
</section>
<section id="auc-of-the-extended-tree" class="level3">
<h3 class="anchored" data-anchor-id="auc-of-the-extended-tree">AUC of the Extended Tree</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>extended_auc_preds <span class="ot">&lt;-</span>  <span class="fu">predict</span>(bank_tree_extended, <span class="at">newdata =</span> bankTest, <span class="at">type =</span> <span class="st">"vector"</span>)[,<span class="dv">2</span>]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>roc.predictions <span class="ot">&lt;-</span> <span class="fu">prediction</span>(extended_auc_preds, bankTest<span class="sc">$</span>y)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>roc.perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.predictions, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc.perf, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"ROC Curve – Extended Model Tree"</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>rf_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.predictions, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>rf_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7688109</code></pre>
</div>
</div>
<p>The AUC of the Extended tree model is lower than the Random Forest at <span class="math inline">\(0.769\)</span>.</p>
</section>
</section>
<section id="lda" class="level2">
<h2 class="anchored" data-anchor-id="lda">LDA</h2>
<p>We run a simple LDA model to determine the effectiveness of a generative classification over the discriminant logistic model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit LDA</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>lda_fit <span class="ot">&lt;-</span> <span class="fu">lda</span>(y <span class="sc">~</span> . <span class="sc">-</span> duration, <span class="at">data =</span> bankTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in lda.default(x, grouping, ...): variables are collinear</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Full prediction object</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>lda_out <span class="ot">&lt;-</span> <span class="fu">predict</span>(lda_fit, <span class="at">newdata =</span> bankTest)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy from class labels</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>lda_acc <span class="ot">&lt;-</span> <span class="fu">mean</span>(lda_out<span class="sc">$</span>class <span class="sc">==</span> bankTest<span class="sc">$</span>y)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># AUC from posterior probabilities</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>lda_prob <span class="ot">&lt;-</span> lda_out<span class="sc">$</span>posterior[, <span class="st">"yes"</span>]   </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>roc_lda  <span class="ot">&lt;-</span> <span class="fu">prediction</span>(lda_prob, bankTest<span class="sc">$</span>y)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>auc_lda  <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc_lda, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print both metrics</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">LDA_Accuracy =</span> lda_acc, <span class="at">LDA_AUC =</span> auc_lda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LDA_Accuracy      LDA_AUC 
   0.8892935    0.7962244 </code></pre>
</div>
</div>
<p>The LDA model shows a higher accuracy of prediction. However, we get a warning about multicollinearity of the data. This likely stems from the economic predictors being very related to one another. The overall accuracy is also not significantly higher than the general data split of the classes. We will continue to explore other models.</p>
</section>
<section id="knn" class="level2">
<h2 class="anchored" data-anchor-id="knn">KNN</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating consistent matrices</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>x_all <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(y <span class="sc">~</span> .<span class="sc">-</span>duration, <span class="at">data =</span> bank)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>y_all <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bank<span class="sc">$</span>y <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> x_all[split, ]</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>x_test  <span class="ot">&lt;-</span> x_all[<span class="sc">-</span>split, ]</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> y_all[split]</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>y_test  <span class="ot">&lt;-</span> y_all[<span class="sc">-</span>split]</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale using training mean and SD</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>x_train_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(x_train)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>x_test_scaled  <span class="ot">&lt;-</span> <span class="fu">scale</span>(x_test,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">center =</span> <span class="fu">attr</span>(x_train_scaled, <span class="st">"scaled:center"</span>),</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">scale  =</span> <span class="fu">attr</span>(x_train_scaled, <span class="st">"scaled:scale"</span>))</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Trying several k values</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>k_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>)</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>knn_acc <span class="ot">&lt;-</span> <span class="fu">sapply</span>(k_values, <span class="cf">function</span>(k) {</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> x_train_scaled, <span class="at">test =</span> x_test_scaled, <span class="at">cl =</span> y_train, <span class="at">k =</span> k)</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(pred <span class="sc">==</span> y_test)</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>knn_acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8816460 0.8909930 0.8928138 0.8937849 0.8943918</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select best k</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>best_k <span class="ot">&lt;-</span> k_values[<span class="fu">which.max</span>(knn_acc)]</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>best_k</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Final model with best k</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>knn_pred <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> x_train_scaled, <span class="at">test =</span> x_test_scaled, <span class="at">cl =</span> y_train, <span class="at">k =</span> best_k)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to numeric for ROC</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>knn_prob <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(knn_pred)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>roc.knn <span class="ot">&lt;-</span> <span class="fu">prediction</span>(knn_prob, y_test)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>roc.perf.knn <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.knn, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc.perf.knn, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"ROC Curve – KNN (k ="</span>, best_k, <span class="st">")"</span>))</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>knn_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.knn, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>knn_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.617616</code></pre>
</div>
</div>
<p>The KNN performs well in terms of overall accuracy, but this can likely be attributed to the overall class imbalance of the dataset. The AUC of <span class="math inline">\(0.6176\)</span> is quite poor and shows that KNN is not suitable for the high dimensionality of our data.</p>
</section>
<section id="svm" class="level2">
<h2 class="anchored" data-anchor-id="svm">SVM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear Kernel SVM</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting linear SVM with probability output</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>svm.lin <span class="ot">&lt;-</span> <span class="fu">svm</span>(</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> .<span class="sc">-</span>duration, <span class="at">data =</span> bankTrain,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"linear"</span>,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost =</span> <span class="dv">1</span>,</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">probability =</span> <span class="cn">TRUE</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(svm.lin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svm(formula = y ~ . - duration, data = bankTrain, kernel = "linear", 
    cost = 1, probability = TRUE)


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  linear 
       cost:  1 

Number of Support Vectors:  8383

 ( 4866 3517 )


Number of Classes:  2 

Levels: 
 no yes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction on test data</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>svm.lin.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm.lin, <span class="at">newdata =</span> bankTest, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>svm.lin.prob <span class="ot">&lt;-</span> <span class="fu">attr</span>(svm.lin.pred, <span class="st">"probabilities"</span>)[, <span class="st">"yes"</span>]</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC and AUC</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>roc.lin <span class="ot">&lt;-</span> <span class="fu">prediction</span>(svm.lin.prob, bankTest<span class="sc">$</span>y)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>roc.perf.lin <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.lin, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  roc.perf.lin, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"ROC Curve – SVM (Linear)"</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>svm_lin_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.lin, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>svm_lin_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6635274</code></pre>
</div>
</div>
<p>The linear SVM results in an AUC of <span class="math inline">\(0.638\)</span>, this is significantly lower than the value of the AUC seen in the paper. We will attempt to tune the SVM to obtain closer results.</p>
<section id="tuning-the-svm" class="level3">
<h3 class="anchored" data-anchor-id="tuning-the-svm">Tuning the SVM</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Smaller sample used for ease of compute</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>bankTrain_sub <span class="ot">&lt;-</span> bankTrain[<span class="fu">sample</span>(<span class="fu">nrow</span>(bankTrain), <span class="dv">5000</span>), ]</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>svm.tune <span class="ot">&lt;-</span> <span class="fu">tune</span>(</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  svm,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> .<span class="sc">-</span>duration, <span class="at">data =</span> bankTrain_sub,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ranges =</span> <span class="fu">list</span>(</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">kernel =</span> <span class="fu">c</span>(<span class="st">"linear"</span>, <span class="st">"radial"</span>),</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cost   =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(svm.tune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Parameter tuning of 'svm':

- sampling method: 10-fold cross validation 

- best parameters:
 kernel cost
 linear   10

- best performance: 0.1022 

- Detailed performance results:
  kernel cost  error dispersion
1 linear  0.1 0.1024 0.01775888
2 radial  0.1 0.1024 0.01775888
3 linear  1.0 0.1030 0.01914274
4 radial  1.0 0.1024 0.01775888
5 linear 10.0 0.1022 0.01860585
6 radial 10.0 0.1026 0.01577762</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>svm.tune<span class="sc">$</span>best.parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  kernel cost
5 linear   10</code></pre>
</div>
</div>
</section>
<section id="final-svm-model" class="level3">
<h3 class="anchored" data-anchor-id="final-svm-model">Final SVM Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>best.svm <span class="ot">&lt;-</span> <span class="fu">svm</span>(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> .<span class="sc">-</span>duration, <span class="at">data =</span> bankTrain,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"radial"</span>,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost =</span> <span class="dv">10</span>,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">probability =</span> <span class="cn">TRUE</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>svm.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(best.svm, <span class="at">newdata =</span> bankTest, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>svm.prob <span class="ot">&lt;-</span> <span class="fu">attr</span>(svm.pred, <span class="st">"probabilities"</span>)[, <span class="st">"yes"</span>]</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>roc.svm <span class="ot">&lt;-</span> <span class="fu">prediction</span>(svm.prob, bankTest<span class="sc">$</span>y)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>roc.perf.svm <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.svm, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  roc.perf.svm, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"ROC Curve – Tuned SVM (Radial, cost = 10)"</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>svm_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.svm, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>svm_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7145553</code></pre>
</div>
</div>
<p>The tuned SVM model performs better than untuned, but still performs worse than the Ridge and LASSO Regression logistic models.</p>
</section>
</section>
<section id="neural-network" class="level2">
<h2 class="anchored" data-anchor-id="neural-network">Neural Network</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make working copies (no re-splitting)</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>bankTrain.nn <span class="ot">&lt;-</span> bankTrain</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>bankTest.nn  <span class="ot">&lt;-</span> bankTest</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify numeric predictors common to both data sets</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>num_train <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which</span>(<span class="fu">sapply</span>(bankTrain.nn, is.numeric)))</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>num_test  <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which</span>(<span class="fu">sapply</span>(bankTest.nn, is.numeric)))</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>common_num <span class="ot">&lt;-</span> <span class="fu">intersect</span>(num_train, num_test)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling numeric predictors using training mean and sd</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>train_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(bankTrain.nn[, common_num])</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>test_scaled  <span class="ot">&lt;-</span> <span class="fu">scale</span>(bankTest.nn[, common_num],</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">center =</span> <span class="fu">attr</span>(train_scaled, <span class="st">"scaled:center"</span>),</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scale  =</span> <span class="fu">attr</span>(train_scaled, <span class="st">"scaled:scale"</span>))</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>bankTrain.nn[, common_num] <span class="ot">&lt;-</span> train_scaled</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>bankTest.nn[, common_num]  <span class="ot">&lt;-</span> test_scaled</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting neural network (1 hidden layer with 5 nodes)</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>nn.model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> .<span class="sc">-</span>duration, <span class="at">data =</span> bankTrain.nn,</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">5</span>, <span class="at">decay =</span> <span class="fl">0.001</span>,</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxit =</span> <span class="dv">200</span>, <span class="at">trace =</span> <span class="cn">FALSE</span></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting teh probabilities on test data</span></span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>nn.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(nn.model, <span class="at">newdata =</span> bankTest.nn, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC and AUC</span></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>roc.nn <span class="ot">&lt;-</span> <span class="fu">prediction</span>(nn.prob, bankTest.nn<span class="sc">$</span>y)</span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>roc.perf.nn <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.nn, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc.perf.nn, <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"ROC Curve – Neural Network (1 hidden layer, 5 nodes)"</span>)</span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final_Report_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>nn_auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc.nn, <span class="st">"auc"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>nn_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.790174</code></pre>
</div>
</div>
<p>The AUC for the Neural Network of <span class="math inline">\(0.79\)</span> is good when compared to our other models, but lacking compared to the AUC of <span class="math inline">\(0.929\)</span> obtained in Moro et al.</p>
</section>
<section id="combined-model-performance-summary" class="level2">
<h2 class="anchored" data-anchor-id="combined-model-performance-summary">Combined Model Performance Summary</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>calc_rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(prob, actual) <span class="fu">sqrt</span>(<span class="fu">mean</span>((actual <span class="sc">-</span> prob)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co"># True response (numeric)</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>actual_num <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bankTest<span class="sc">$</span>y <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE values </span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>rmse_paper <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(bankTest<span class="sc">$</span>pred_prob, actual_num)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>rmse_ext   <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(bankTest<span class="sc">$</span>pred_prob_ext, actual_num)</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>rmse_ridge <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(ridge_pred, actual_num)</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>rmse_lasso <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(lasso_pred, actual_num)</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>rmse_tree  <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(<span class="fu">predict</span>(bank_tree_extended, <span class="at">newdata =</span> bankTest, <span class="at">type =</span> <span class="st">"vector"</span>)[, <span class="dv">2</span>], actual_num)</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>rmse_rf    <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(<span class="fu">predict</span>(bank_rf, <span class="at">newdata =</span> bankTest, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"yes"</span>], actual_num)</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>rmse_lda   <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(<span class="fu">predict</span>(lda_fit, <span class="at">newdata =</span> bankTest)<span class="sc">$</span>posterior[, <span class="dv">2</span>], actual_num)</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>rmse_knn   <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(<span class="fu">ifelse</span>(knn_pred <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>), actual_num)</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>rmse_svm   <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(svm.prob, actual_num)</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>rmse_nn    <span class="ot">&lt;-</span> <span class="fu">calc_rmse</span>(nn.prob, actual_num)</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a><span class="co"># AUC values (already computed) </span></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>auc_values <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>paper_auc,</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>extended_auc,</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>ridge_auc,</span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>lasso_auc,</span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a><span class="fl">0.769</span>,  <span class="co"># Decision Tree (Extended)</span></span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a><span class="fl">0.802</span>,  <span class="co"># Random Forest</span></span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a><span class="fl">0.796</span>,  <span class="co"># LDA</span></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a><span class="fl">0.6176</span>, <span class="co"># KNN</span></span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>svm_auc,</span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>nn_auc</span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a>model_summary_auc_rmse <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a><span class="at">Model =</span> <span class="fu">c</span>(</span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a><span class="st">"Logistic (Paper)"</span>,</span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a><span class="st">"Logistic (Extended)"</span>,</span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a><span class="st">"Ridge Regression"</span>,</span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a><span class="st">"LASSO Regression"</span>,</span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a><span class="st">"Decision Tree (Extended)"</span>,</span>
<span id="cb104-45"><a href="#cb104-45" aria-hidden="true" tabindex="-1"></a><span class="st">"Random Forest"</span>,</span>
<span id="cb104-46"><a href="#cb104-46" aria-hidden="true" tabindex="-1"></a><span class="st">"LDA"</span>,</span>
<span id="cb104-47"><a href="#cb104-47" aria-hidden="true" tabindex="-1"></a><span class="st">"K-Nearest Neighbor"</span>,</span>
<span id="cb104-48"><a href="#cb104-48" aria-hidden="true" tabindex="-1"></a><span class="st">"SVM (Radial, Tuned)"</span>,</span>
<span id="cb104-49"><a href="#cb104-49" aria-hidden="true" tabindex="-1"></a><span class="st">"Neural Network"</span></span>
<span id="cb104-50"><a href="#cb104-50" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb104-51"><a href="#cb104-51" aria-hidden="true" tabindex="-1"></a><span class="at">RMSE =</span> <span class="fu">c</span>(</span>
<span id="cb104-52"><a href="#cb104-52" aria-hidden="true" tabindex="-1"></a>rmse_paper,</span>
<span id="cb104-53"><a href="#cb104-53" aria-hidden="true" tabindex="-1"></a>rmse_ext,</span>
<span id="cb104-54"><a href="#cb104-54" aria-hidden="true" tabindex="-1"></a>rmse_ridge,</span>
<span id="cb104-55"><a href="#cb104-55" aria-hidden="true" tabindex="-1"></a>rmse_lasso,</span>
<span id="cb104-56"><a href="#cb104-56" aria-hidden="true" tabindex="-1"></a>rmse_tree,</span>
<span id="cb104-57"><a href="#cb104-57" aria-hidden="true" tabindex="-1"></a>rmse_rf,</span>
<span id="cb104-58"><a href="#cb104-58" aria-hidden="true" tabindex="-1"></a>rmse_lda,</span>
<span id="cb104-59"><a href="#cb104-59" aria-hidden="true" tabindex="-1"></a>rmse_knn,</span>
<span id="cb104-60"><a href="#cb104-60" aria-hidden="true" tabindex="-1"></a>rmse_svm,</span>
<span id="cb104-61"><a href="#cb104-61" aria-hidden="true" tabindex="-1"></a>rmse_nn</span>
<span id="cb104-62"><a href="#cb104-62" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb104-63"><a href="#cb104-63" aria-hidden="true" tabindex="-1"></a><span class="at">AUC =</span> auc_values</span>
<span id="cb104-64"><a href="#cb104-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-65"><a href="#cb104-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-66"><a href="#cb104-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb104-67"><a href="#cb104-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-68"><a href="#cb104-68" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb104-69"><a href="#cb104-69" aria-hidden="true" tabindex="-1"></a>model_summary_auc_rmse,</span>
<span id="cb104-70"><a href="#cb104-70" aria-hidden="true" tabindex="-1"></a><span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb104-71"><a href="#cb104-71" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="st">"Model Performance Summary (AUC and RMSE)"</span></span>
<span id="cb104-72"><a href="#cb104-72" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Performance Summary (AUC and RMSE)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">RMSE</th>
<th style="text-align: right;">AUC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Logistic (Paper)</td>
<td style="text-align: right;">0.2859</td>
<td style="text-align: right;">0.7885</td>
</tr>
<tr class="even">
<td style="text-align: left;">Logistic (Extended)</td>
<td style="text-align: right;">0.2849</td>
<td style="text-align: right;">0.7895</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ridge Regression</td>
<td style="text-align: right;">0.2799</td>
<td style="text-align: right;">0.7955</td>
</tr>
<tr class="even">
<td style="text-align: left;">LASSO Regression</td>
<td style="text-align: right;">0.2788</td>
<td style="text-align: right;">0.7981</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Decision Tree (Extended)</td>
<td style="text-align: right;">0.2825</td>
<td style="text-align: right;">0.7690</td>
</tr>
<tr class="even">
<td style="text-align: left;">Random Forest</td>
<td style="text-align: right;">0.2787</td>
<td style="text-align: right;">0.8020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LDA</td>
<td style="text-align: right;">0.2922</td>
<td style="text-align: right;">0.7960</td>
</tr>
<tr class="even">
<td style="text-align: left;">K-Nearest Neighbor</td>
<td style="text-align: right;">0.3373</td>
<td style="text-align: right;">0.6176</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SVM (Radial, Tuned)</td>
<td style="text-align: right;">0.2914</td>
<td style="text-align: right;">0.7146</td>
</tr>
<tr class="even">
<td style="text-align: left;">Neural Network</td>
<td style="text-align: right;">0.2801</td>
<td style="text-align: right;">0.7902</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Our final results show that the Random Forest model performs the best at classification. This differs from the results of the paper, where the neural network performed the best. Overall our results for AUC were lower than what was seen in Moro et al.&nbsp;We believe this due to differences in the dataset. The version we are able to use does not have some of the proprietary predictors used by the authors. We also used k-fold for our cross validation when possible. The authors used a rolling window method of model training instead. This may have also led to their higher AUC values.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>